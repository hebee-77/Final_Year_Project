{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ material.title }} - AI-Powered LMS{% endblock %}

{% block content %}
<div class="container">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'content:course_list' %}">Courses</a></li>
            <li class="breadcrumb-item"><a href="{% url 'content:course_detail' course.pk %}">{{ course.title }}</a></li>
            <li class="breadcrumb-item active">{{ material.title }}</li>
        </ol>
    </nav>
    
    <div class="card">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <h4 class="mb-0">
                    {% if material.material_type == 'PDF' %}
                    <i class="bi bi-file-pdf text-danger me-2"></i>
                    {% elif material.material_type == 'VIDEO' %}
                    <i class="bi bi-camera-video text-primary me-2"></i>
                    {% elif material.material_type == 'LINK' %}
                    <i class="bi bi-link-45deg text-info me-2"></i>
                    {% else %}
                    <i class="bi bi-file-text text-secondary me-2"></i>
                    {% endif %}
                    {{ material.title }}
                </h4>
                <span class="badge bg-primary">{{ material.get_material_type_display }}</span>
            </div>
        </div>
        <div class="card-body">
            {% if material.material_type == 'TEXT' %}
            <div class="material-content">
                {{ material.content|linebreaks }}
            </div>
            {% elif material.material_type == 'PDF' and material.file %}
            <div class="text-center py-4">
                <i class="bi bi-file-pdf text-danger" style="font-size: 4rem;"></i>
                <p class="mt-3">PDF Document</p>
                <a href="{{ material.file.url }}" class="btn btn-primary" target="_blank">
                    <i class="bi bi-download me-2"></i>Download PDF
                </a>
            </div>
            {% elif material.material_type == 'VIDEO' and material.file %}
            <div class="ratio ratio-16x9">
                <video controls>
                    <source src="{{ material.file.url }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
            {% elif material.material_type == 'LINK' and material.external_link %}
            <div class="text-center py-4">
                <i class="bi bi-link-45deg text-info" style="font-size: 4rem;"></i>
                <p class="mt-3">External Resource</p>
                <a href="{{ material.external_link }}" class="btn btn-primary" target="_blank">
                    <i class="bi bi-box-arrow-up-right me-2"></i>Open Link
                </a>
            </div>
            {% endif %}
            
            {% if user == course.teacher or user.is_admin %}
            <div class="mt-4 pt-4 border-top">
                <a href="{% url 'content:material_edit' material.pk %}" class="btn btn-warning">
                    <i class="bi bi-pencil me-2"></i>Edit
                </a>
                <form method="post" action="{% url 'content:material_delete' material.pk %}" 
                      class="d-inline" onsubmit="return confirm('Are you sure?');">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash me-2"></i>Delete
                    </button>
                </form>
            </div>
            {% endif %}
        </div>
    </div>
    
    {% if user.is_student %}
    <div class="card mt-3">
        <div class="card-header bg-success text-white">
            <h6 class="mb-0"><i class="bi bi-robot me-2"></i>Need Help Understanding?</h6>
        </div>
        <div class="card-body">
            <p>Use AI to get summaries, explanations, or practice questions for this material.</p>
            <div class="d-flex gap-2">
                <a href="{% url 'ai_assistant:generate_summary' %}" class="btn btn-outline-primary">
                    <i class="bi bi-file-text me-2"></i>Generate Summary
                </a>
                <a href="{% url 'ai_assistant:generate_explanation' %}" class="btn btn-outline-info">
                    <i class="bi bi-lightbulb me-2"></i>Get Explanation
                </a>
                <a href="{% url 'ai_assistant:chat' %}" class="btn btn-outline-success">
                    <i class="bi bi-chat-dots me-2"></i>Ask AI
                </a>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
